<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>자기소개서 매니저 - 글자 수 계산기</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "border-subtle": "#d4d4d8",
                        "text-muted": "#71717a",
                        "accent": "#18181b",
                        "sidebar-bg": "#f4f4f5",
                        "border-color": "#d4d4d8",
                    },
                    fontFamily: {
                        "sans": ["'Pretendard'", "'Noto Sans KR'", "sans-serif"]
                    },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
            background-color: #ffffff;
            -webkit-font-smoothing: antialiased;
            letter-spacing: -0.02em;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        textarea::placeholder {
            color: #a1a1aa;
            font-weight: 400;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .counter-card {
            border-bottom: 2px solid #e4e4e7;
            padding-bottom: 2rem;
            margin-bottom: 2rem;
        }
        .counter-card:last-child {
            border-bottom: none;
        }
        .list-row:hover .row-actions {
            opacity: 1;
        }
        /* View transitions */
        .view {
            opacity: 0;
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity 0.2s ease;
        }
        .view.active {
            opacity: 1;
            pointer-events: auto;
            position: relative;
        }
        #app {
            position: relative;
            min-height: 100vh;
        }
    </style>
</head>
<body class="text-zinc-900 min-h-screen bg-white overflow-hidden">
    <div id="app">
        <!-- Document List View -->
        <div id="view-documents" class="view flex h-screen overflow-hidden">
            <aside class="w-72 flex-shrink-0 bg-sidebar-bg border-r-2 border-border-color flex flex-col">
                <div class="p-10 flex flex-col h-full">
                    <div class="mb-14">
                        <h1 class="text-lg font-bold tracking-tight mb-10">자기소개서 매니저</h1>
                        <button id="btn-new-doc" class="flex items-center gap-3 text-zinc-600 hover:text-black transition-colors text-base group">
                            <span class="material-symbols-outlined text-2xl">add</span>
                            <span class="font-semibold underline underline-offset-4 decoration-zinc-300 group-hover:decoration-black transition-all">새 문서 작성</span>
                        </button>
                    </div>
                    <nav class="flex flex-col gap-10 flex-1">
                        <div class="flex flex-col gap-4">
                            <span class="text-xs font-bold text-zinc-500 uppercase tracking-[0.1em]">탐색</span>
                            <a class="flex items-center gap-4 text-base text-black font-semibold cursor-pointer filter-link" data-filter="all">
                                <span class="material-symbols-outlined text-xl">description</span>
                                전체 문서
                            </a>
                            <a class="flex items-center gap-4 text-base text-zinc-500 hover:text-black transition-colors cursor-pointer filter-link" data-filter="favorites">
                                <span class="material-symbols-outlined text-xl">star</span>
                                즐겨찾기
                            </a>
                        </div>
                        <div class="flex flex-col gap-4">
                            <span class="text-xs font-bold text-zinc-500 uppercase tracking-[0.1em]">카테고리</span>
                            <a class="flex items-center gap-4 text-base text-zinc-500 hover:text-black transition-colors cursor-pointer filter-link" data-filter="IT/개발">
                                <span class="material-symbols-outlined text-xl">folder</span>
                                IT/개발
                            </a>
                            <a class="flex items-center gap-4 text-base text-zinc-500 hover:text-black transition-colors cursor-pointer filter-link" data-filter="마케팅/기획">
                                <span class="material-symbols-outlined text-xl">folder</span>
                                마케팅/기획
                            </a>
                            <a class="flex items-center gap-4 text-base text-zinc-500 hover:text-black transition-colors cursor-pointer filter-link" data-filter="공기업/공공기관">
                                <span class="material-symbols-outlined text-xl">folder</span>
                                공기업/공공기관
                            </a>
                        </div>
                    </nav>
                    <div class="pt-8 border-t-2 border-zinc-300">
                        <div class="flex items-center gap-4">
                            <div class="size-10 rounded-full bg-zinc-300 flex items-center justify-center">
                                <span class="material-symbols-outlined text-zinc-600 text-lg">person</span>
                            </div>
                            <span class="text-sm font-semibold text-zinc-700">사용자</span>
                        </div>
                    </div>
                </div>
            </aside>
            <main class="flex-1 flex flex-col overflow-y-auto bg-white">
                <header class="px-14 py-10 flex items-center justify-between sticky top-0 bg-white/95 backdrop-blur-sm z-10 border-b border-zinc-200">
                    <div class="flex-1 max-w-lg">
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-0 top-1/2 -translate-y-1/2 text-zinc-500 text-2xl">search</span>
                            <input id="search-input" class="w-full pl-10 py-3 bg-transparent border-none text-base focus:ring-0 placeholder:text-zinc-400" placeholder="검색어 입력" type="text"/>
                        </div>
                    </div>
                    <div class="flex items-center gap-6">
                        <button class="text-zinc-500 hover:text-black transition-colors">
                            <span class="material-symbols-outlined text-2xl">tune</span>
                        </button>
                    </div>
                </header>
                <div class="px-14 pb-20 max-w-6xl w-full">
                    <div class="mb-14 mt-10">
                        <h2 class="text-3xl font-medium text-zinc-900 tracking-tight">문서 보관함</h2>
                        <p id="doc-count" class="text-zinc-500 text-base mt-2">총 0개의 문서가 보관되어 있습니다.</p>
                    </div>
                    <div class="w-full">
                        <div class="grid grid-cols-12 px-6 py-4 border-b-2 border-zinc-200 text-sm font-bold text-zinc-600 tracking-wider">
                            <div class="col-span-5">제목</div>
                            <div class="col-span-2">카테고리</div>
                            <div class="col-span-2">최종 수정일</div>
                            <div class="col-span-2">글자 수</div>
                            <div class="col-span-1 text-right">관리</div>
                        </div>
                        <div id="document-list" class="divide-y divide-zinc-200">
                            <!-- Documents will be rendered here -->
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Editor View -->
        <div id="view-editor" class="view flex flex-col">
            <header class="w-full border-b-2 border-border-subtle bg-white px-12 py-6 z-10">
                <div class="max-w-[1600px] mx-auto flex items-center justify-between">
                    <div class="flex items-center gap-8">
                        <button id="btn-back" class="flex items-center gap-3 text-zinc-600 hover:text-black transition-colors">
                            <span class="material-symbols-outlined text-2xl">arrow_back</span>
                            <span class="text-sm font-semibold">돌아가기</span>
                        </button>
                        <div class="h-5 w-px bg-zinc-300"></div>
                        <span class="text-sm text-text-muted font-medium tracking-tight">자기소개서 작성 도우미</span>
                    </div>
                    <div class="flex items-center gap-10">
                        <button id="btn-delete" class="text-sm tracking-tight text-red-500 hover:text-red-700 transition-colors font-semibold">삭제</button>
                        <div class="flex items-center gap-3">
                            <span class="text-sm text-text-muted font-medium">카테고리:</span>
                            <select id="editor-category" class="text-sm border-2 border-zinc-200 bg-zinc-50 rounded-lg px-4 py-2 focus:ring-1 focus:ring-zinc-400">
                                <option value="">선택 없음</option>
                                <option value="IT/개발">IT/개발</option>
                                <option value="마케팅/기획">마케팅/기획</option>
                                <option value="공기업/공공기관">공기업/공공기관</option>
                            </select>
                        </div>
                    </div>
                </div>
            </header>
            <div class="flex-1 flex max-w-[1600px] mx-auto w-full px-12 overflow-hidden">
                <main class="flex-1 flex flex-col pt-14 pr-14 overflow-hidden">
                    <div class="mb-12">
                        <input id="editor-title" class="text-4xl font-medium tracking-tight text-zinc-500 mb-3 border-none p-0 focus:ring-0 w-full focus:text-zinc-900" spellcheck="false" type="text" placeholder="문서 제목"/>
                        <div class="flex items-center gap-4 text-sm tracking-tight text-text-muted font-medium">
                            <span class="flex items-center gap-2">
                                <span id="save-indicator" class="size-2 rounded-full bg-zinc-400"></span>
                                <span id="save-status">자동 저장 중</span>
                            </span>
                            <span class="text-zinc-300">|</span>
                            <span id="last-modified">최근 수정: -</span>
                        </div>
                    </div>
                    <div class="flex-1 flex flex-col overflow-hidden">
                        <textarea id="main-editor" class="flex-1 w-full text-xl font-normal leading-relaxed border-none focus:ring-0 resize-none bg-transparent p-0 scrollbar-hide text-zinc-800" placeholder="이곳에 내용을 입력하세요..." spellcheck="false"></textarea>
                    </div>
                </main>
                <aside class="w-96 border-l-2 border-border-subtle py-14 pl-14 flex flex-col overflow-y-auto">
                    <div class="mb-14">
                        <div class="counter-card">
                            <span class="text-sm tracking-widest text-zinc-500 font-bold uppercase mb-5 block">공백 포함</span>
                            <div class="flex items-baseline gap-3">
                                <span id="count-with-spaces" class="text-8xl font-black tracking-tighter text-zinc-900">0</span>
                                <span class="text-xl text-zinc-500 font-medium">자</span>
                            </div>
                        </div>
                        <div class="counter-card">
                            <span class="text-sm tracking-widest text-zinc-500 font-bold uppercase mb-5 block">공백 제외</span>
                            <div class="flex items-baseline gap-3">
                                <span id="count-without-spaces" class="text-8xl font-black tracking-tighter text-zinc-900">0</span>
                                <span class="text-xl text-zinc-500 font-medium">자</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-10 mt-12">
                            <div class="flex flex-col gap-2">
                                <span class="text-sm tracking-widest text-zinc-500 font-bold uppercase">바이트</span>
                                <div class="flex items-baseline gap-2">
                                    <span id="byte-count" class="text-3xl font-semibold text-zinc-900">0</span>
                                    <span class="text-sm text-zinc-500 font-medium uppercase tracking-tighter">B</span>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2">
                                <span class="text-sm tracking-widest text-zinc-500 font-bold uppercase">읽기 시간</span>
                                <div class="flex items-baseline gap-2">
                                    <span id="reading-time" class="text-3xl font-semibold text-zinc-900">0</span>
                                    <span class="text-sm text-zinc-500 font-medium">분</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-auto space-y-10">
                        <div class="flex flex-col gap-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm tracking-widest text-zinc-600 font-bold uppercase">목표 글자 수</span>
                                <input id="target-count" type="number" class="w-28 text-right text-base border-2 border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-zinc-400" value="1000" min="1"/>
                            </div>
                            <div class="flex justify-between items-end mt-2">
                                <span class="text-sm tracking-widest text-zinc-600 font-bold uppercase">권장 분량 달성도</span>
                                <span id="progress-percent" class="text-base text-zinc-900 font-bold">0%</span>
                            </div>
                            <div class="w-full h-2 bg-zinc-200 rounded-full overflow-hidden">
                                <div id="progress-bar" class="h-full bg-zinc-900 transition-all duration-300 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 py-5 px-6 bg-zinc-100 rounded-xl border border-zinc-200">
                            <span class="material-symbols-outlined text-2xl text-zinc-500">save</span>
                            <span class="text-sm tracking-tight font-semibold text-zinc-700">로컬 저장소에 저장됨</span>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>

    <script>
        // ==================== Storage ====================
        const STORAGE_KEY = 'character-counter-documents';

        function getDocuments() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }

        function saveDocuments(documents) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(documents));
        }

        function getDocument(id) {
            const documents = getDocuments();
            return documents.find(doc => doc.id === id);
        }

        function createDocument() {
            const documents = getDocuments();
            const newDoc = {
                id: Date.now().toString(),
                title: '새 문서',
                content: '',
                targetCount: 1000,
                category: '',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            documents.unshift(newDoc);
            saveDocuments(documents);
            return newDoc;
        }

        function updateDocument(id, updates) {
            const documents = getDocuments();
            const index = documents.findIndex(doc => doc.id === id);
            if (index !== -1) {
                documents[index] = { ...documents[index], ...updates, updatedAt: new Date().toISOString() };
                saveDocuments(documents);
                return documents[index];
            }
            return null;
        }

        function deleteDocument(id) {
            const documents = getDocuments();
            const filtered = documents.filter(doc => doc.id !== id);
            saveDocuments(filtered);
        }

        // ==================== Router ====================
        const views = {
            documents: document.getElementById('view-documents'),
            editor: document.getElementById('view-editor')
        };

        let currentView = null;
        let currentDocId = null;

        function navigate(hash) {
            window.location.hash = hash;
        }

        function parseRoute() {
            const hash = window.location.hash || '#/documents';

            if (hash === '#/' || hash === '#/documents' || hash === '') {
                return { view: 'documents', params: {} };
            }

            if (hash.startsWith('#/editor/')) {
                const id = hash.replace('#/editor/', '');
                return { view: 'editor', params: { id } };
            }

            return { view: 'documents', params: {} };
        }

        function switchView(viewName) {
            Object.keys(views).forEach(key => {
                views[key].classList.remove('active');
            });

            setTimeout(() => {
                views[viewName].classList.add('active');
                currentView = viewName;
            }, 10);
        }

        function handleRoute() {
            const route = parseRoute();

            if (route.view === 'documents') {
                switchView('documents');
                renderDocumentList();
            } else if (route.view === 'editor') {
                const id = route.params.id;
                if (id === 'new') {
                    const newDoc = createDocument();
                    navigate(`#/editor/${newDoc.id}`);
                    return;
                }
                currentDocId = id;
                switchView('editor');
                loadDocument(id);
            }
        }

        // ==================== Document List View ====================
        let currentFilter = 'all';
        let searchQuery = '';

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;

            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return '방금 전';
            if (minutes < 60) return `${minutes}분 전`;
            if (hours < 24) return `${hours}시간 전`;
            if (days < 7) return `${days}일 전`;

            return date.toLocaleDateString('ko-KR');
        }

        function renderDocumentList() {
            const documents = getDocuments();
            const listEl = document.getElementById('document-list');
            const countEl = document.getElementById('doc-count');

            let filtered = documents;

            // Apply category filter
            if (currentFilter !== 'all' && currentFilter !== 'favorites') {
                filtered = filtered.filter(doc => doc.category === currentFilter);
            }

            // Apply search filter
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filtered = filtered.filter(doc =>
                    doc.title.toLowerCase().includes(query) ||
                    doc.content.toLowerCase().includes(query)
                );
            }

            countEl.textContent = `총 ${filtered.length}개의 문서가 보관되어 있습니다.`;

            if (filtered.length === 0) {
                listEl.innerHTML = `
                    <div class="py-20 text-center text-zinc-500">
                        <span class="material-symbols-outlined text-6xl mb-6 block">description</span>
                        <p class="text-lg font-medium">문서가 없습니다.</p>
                        <button onclick="navigate('#/editor/new')" class="mt-6 text-base text-zinc-700 hover:text-black underline font-semibold">새 문서 작성하기</button>
                    </div>
                `;
                return;
            }

            listEl.innerHTML = filtered.map(doc => {
                const charCount = doc.content.length;
                const isComplete = charCount >= doc.targetCount;

                return `
                    <div class="grid grid-cols-12 items-center px-6 py-7 list-row group cursor-pointer hover:bg-zinc-100 transition-colors" onclick="navigate('#/editor/${doc.id}')">
                        <div class="col-span-5 flex items-center gap-4">
                            <span class="size-3 rounded-full ${isComplete ? 'bg-green-500' : 'bg-zinc-800'}"></span>
                            <span class="text-base font-semibold text-zinc-900 truncate">${escapeHtml(doc.title)}</span>
                        </div>
                        <div class="col-span-2 text-sm text-zinc-600 font-medium">${doc.category || '-'}</div>
                        <div class="col-span-2 text-sm text-zinc-600">${formatDate(doc.updatedAt)}</div>
                        <div class="col-span-2 text-sm text-zinc-700 font-mono font-semibold">${charCount.toLocaleString()} / ${doc.targetCount.toLocaleString()}</div>
                        <div class="col-span-1 flex justify-end gap-4 opacity-0 row-actions transition-opacity">
                            <button onclick="event.stopPropagation(); confirmDelete('${doc.id}')" class="text-zinc-500 hover:text-red-600 transition-colors">
                                <span class="material-symbols-outlined text-2xl">delete</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function confirmDelete(id) {
            if (confirm('이 문서를 삭제하시겠습니까?')) {
                deleteDocument(id);
                renderDocumentList();
            }
        }

        // Filter links
        document.querySelectorAll('.filter-link').forEach(link => {
            link.addEventListener('click', () => {
                document.querySelectorAll('.filter-link').forEach(l => {
                    l.classList.remove('text-black', 'font-semibold');
                    l.classList.add('text-zinc-500');
                });
                link.classList.remove('text-zinc-500');
                link.classList.add('text-black', 'font-semibold');

                currentFilter = link.dataset.filter;
                renderDocumentList();
            });
        });

        // Search
        document.getElementById('search-input').addEventListener('input', (e) => {
            searchQuery = e.target.value;
            renderDocumentList();
        });

        // New document button
        document.getElementById('btn-new-doc').addEventListener('click', () => {
            navigate('#/editor/new');
        });

        // ==================== Editor View ====================
        const editorEl = document.getElementById('main-editor');
        const titleEl = document.getElementById('editor-title');
        const categoryEl = document.getElementById('editor-category');
        const targetCountEl = document.getElementById('target-count');
        const withSpacesEl = document.getElementById('count-with-spaces');
        const withoutSpacesEl = document.getElementById('count-without-spaces');
        const byteCountEl = document.getElementById('byte-count');
        const readingTimeEl = document.getElementById('reading-time');
        const progressBarEl = document.getElementById('progress-bar');
        const progressPercentEl = document.getElementById('progress-percent');
        const saveStatusEl = document.getElementById('save-status');
        const saveIndicatorEl = document.getElementById('save-indicator');
        const lastModifiedEl = document.getElementById('last-modified');

        let saveTimeout = null;

        function loadDocument(id) {
            const doc = getDocument(id);
            if (!doc) {
                navigate('#/documents');
                return;
            }

            titleEl.value = doc.title;
            editorEl.value = doc.content;
            categoryEl.value = doc.category || '';
            targetCountEl.value = doc.targetCount;
            lastModifiedEl.textContent = `최근 수정: ${formatDate(doc.updatedAt)}`;

            updateCounts();
        }

        function updateCounts() {
            const text = editorEl.value;
            const countAll = text.length;
            const countNoSpaces = text.replace(/\s/g, '').length;

            // Byte calculation
            let bytes = 0;
            for (let i = 0; i < text.length; i++) {
                const charCode = text.charCodeAt(i);
                bytes += (charCode > 127) ? 2 : 1;
            }

            const readTime = Math.ceil(countAll / 400) || 0;
            const targetGoal = parseInt(targetCountEl.value) || 1000;
            const percent = Math.min(Math.round((countAll / targetGoal) * 100), 100);

            withSpacesEl.textContent = countAll.toLocaleString();
            withoutSpacesEl.textContent = countNoSpaces.toLocaleString();
            byteCountEl.textContent = bytes.toLocaleString();
            readingTimeEl.textContent = readTime;
            progressBarEl.style.width = percent + '%';
            progressPercentEl.textContent = percent + '%';
        }

        function saveDocument() {
            if (!currentDocId) return;

            saveStatusEl.textContent = '저장 중...';
            saveIndicatorEl.classList.remove('bg-zinc-400', 'bg-green-500');
            saveIndicatorEl.classList.add('bg-yellow-500');

            updateDocument(currentDocId, {
                title: titleEl.value || '제목 없음',
                content: editorEl.value,
                category: categoryEl.value,
                targetCount: parseInt(targetCountEl.value) || 1000
            });

            setTimeout(() => {
                saveStatusEl.textContent = '저장됨';
                saveIndicatorEl.classList.remove('bg-yellow-500');
                saveIndicatorEl.classList.add('bg-green-500');
                lastModifiedEl.textContent = `최근 수정: 방금 전`;
            }, 300);
        }

        function debouncedSave() {
            if (saveTimeout) clearTimeout(saveTimeout);
            saveTimeout = setTimeout(saveDocument, 500);
        }

        editorEl.addEventListener('input', () => {
            updateCounts();
            debouncedSave();
        });

        titleEl.addEventListener('input', debouncedSave);
        categoryEl.addEventListener('change', debouncedSave);
        targetCountEl.addEventListener('input', () => {
            updateCounts();
            debouncedSave();
        });

        // Back button
        document.getElementById('btn-back').addEventListener('click', () => {
            navigate('#/documents');
        });

        // Delete button
        document.getElementById('btn-delete').addEventListener('click', () => {
            if (currentDocId && confirm('이 문서를 삭제하시겠습니까?')) {
                deleteDocument(currentDocId);
                navigate('#/documents');
            }
        });

        // ==================== Initialize ====================
        window.addEventListener('hashchange', handleRoute);

        // Initial route
        handleRoute();
    </script>
</body>
</html>
